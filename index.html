
<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>Exemplo de formulário para checkout usando Bootstrap</title>

    <!-- Principal CSS do Bootstrap -->
    <link rel="stylesheet" href="css/bootstrap.min.css">


    <!-- Include Bootstrap Datepicker -->
    <link rel="stylesheet" href="css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="css/bootstrap-timepicker.css" />

    <style>
      .list-group{
          max-height: 300px;
          margin-bottom: 10px;
          overflow:scroll;
          -webkit-overflow-scrolling: touch;
      }
    </style>

  </head>

  <body class="bg-light">

    <div class="container">
      <div class="py-5 text-center">
        <h2>Sistema de Organização de eventos</h2>
        <p class="lead">Simples sistema que organizar horários e datas de eventos de forma que não haja choque de horarios</p>
      </div>

      <div class="row">
        <div class="col-md-4 order-md-2 mb-4">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-muted">Lista de eventos</span>
            <span class="badge badge-secondary badge-pill" id="quanti">0</span>
          </h4>
          <ul class="list-group mb-3" id="listaEnv">
          </ul>

          <form class="card p-2">
            <div class="input-group">
              <div class="input-group-append">
                <button type="button" class="btn btn-success" onclick="organizar()">Organizar</button>
              </div>
              <div class="input-group-append">
                  <button type="button" class="btn btn-danger" onclick="limpar()" style="left: 162px;">Limpar</button>
              </div>
            </div>
          </form>

        </div>
        <div class="col-md-8 order-md-1">
          <h4 class="mb-3">Adicionar eventos</h4>
          <form class="needs-validation">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="primeiroNome">Descrição:</label>
                <input type="text" class="form-control" id="descri" placeholder="Descrição do evento">
              </div>
              <div class="col-md-6 mb-3">
                  <label for="sobrenome">Data:</label>
                  <input type="text" class="form-control" id="datepicker" placeholder="Data do evento">
              </div>
            </div>

            <label for="hor">Horário:</label>
            <div class="row">
              <div class="col-md-6 mb-3 ">
                  <input type="text" class="form-control" id="timepicker1" placeholder="Inicio">
                  <i class="glyphicon glyphicon-chevron-up"></i>
              </div>
              <div class="col-md-6 mb-3">
                  <input type="text" class="form-control" id="timepicker2" placeholder="Fim">
              </div>
            </div>
            <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input" id="priori">
              <label class="custom-control-label" for="priori">Priorizar evento.</label>
            </div>
            <hr class="mb-4">
            <button class="btn btn-primary btn-lg btn-block" id="adiciona" type="button">Adicionar evento</button>
          </form>
        </div>
        
        <div class="order-md-3" style="width:800px; margin:0 auto;" id="showRes">
        </div>

      </div>
    </div>

    <!-- Principal JavaScript do Bootstrap
    ================================================== -->
    <!-- Foi colocado no final para a página carregar mais rápido -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="js/bootstrap-datepicker.min.js"></script>
    <script src="js/bootstrap-timepicker.js"></script>

    <script>
      $(function() {
        $.fn.datepicker.dates["pt-BR"] = {
          days: ["Domingo", "Segunda", "Terça", "Quarta", "Quinta", "Sexta", "Sábado"],
          daysShort: ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"],
          daysMin: ["Do", "Se", "Te", "Qu", "Qu", "Se", "Sa"],
          months: ["Janeiro", "Fevereiro", "Março", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"],
          monthsShort: ["Jan", "Fev", "Mar", "Abr", "Mai", "Jun", "Jul", "Ago", "Set", "Out", "Nov", "Dez"],
          today: "Hoje",
          monthsTitle: "Meses",
          clear: "Limpar",
          format: "dd/mm/yyyy"
        };
        $('#datepicker').datepicker({
          format: 'dd/mm/yyyy',                
          language: 'pt-BR'
        });
      });
    </script>

    <script>
      $('#timepicker1').timepicker();
      $('#timepicker2').timepicker();
    </script>

    <script>
      var listaEventos = {};
      var adicionarBut = document.getElementById("adiciona");
      var lista = document.getElementById("listaEnv");
      var listaRes = document.getElementById("showRes");
      document.getElementById('timepicker1').value = '';
      document.getElementById('timepicker2').value = '';

      function coverteData(data){
        var d1 = data.split("/");
        var d2 = d1[1] + "-" + d1[0] + "-" + d1[2] + " " + "0:0";
        return new Date(d2).getTime();
      }

      function coverteHorario(hora){
        var h1 = "12/12/2012 " + hora;
        return new Date(h1).getTime();
      }

      function covDatHor(data, hora){
        var dh1 = data.split("/");
        var dh2 = dh1[1] + "-" + dh1[0] + "-" + dh1[2] + " " + hora;
        return new Date(dh2).getTime();
      }

      function Evento(der, dat, hoi, hof, pri){
        this.der = der;
        this.dathof = covDatHor(dat, hof);
        this.dat = coverteData(dat);
        this.hoi = coverteHorario(hoi);
        this.hof = coverteHorario(hof);
        this.pri = pri;
        this.dados = {
          desr: der,
          data: dat,
          hori: hoi,
          horf: hof
        }
      }

      adicionarBut.addEventListener('click', function(){
        $("input:not(:checkbox)").each(function() {
          if($(this).val() === ""){
            alert("Preencha Todos os Campos!!");
            return false;
          }
          else{
            adicionaEvento();
            return false;
          }

        })});
      
      function adicionaEvento(){
        var descricaoVal = $("#descri").val();
        var dataVal = $("#datepicker").val();
        var horaIniVal = $("#timepicker1").val();
        var horaFimVal = $("#timepicker2").val();
        var pri = document.getElementById("priori").checked;
        var normal = 'Não';

        listaEventos[descricaoVal] = new Evento(descricaoVal, dataVal, horaIniVal, horaFimVal, pri); 

        if(pri == true){
          normal = 'Sim';
        }
        var id = "'" + descricaoVal + "'";
        lista.innerHTML += '<li class="list-group-item d-flex justify-content-between lh-condensed" id="' + descricaoVal + '"><div><h6 class="my-0">' + descricaoVal + '</h6><h6><small class="text-muted">Data: ' + dataVal + '</small></h6><h6><small class="text-muted">Horario: ' + horaIniVal + ' a ' + horaFimVal + '</small></h6><h6><small class="text-muted">Prioridade: '+ normal + '</small></h6></div><a><button type="button" class="btn btn-danger btn-sm" onclick="removeEvento('+ id +')">Deletar</button></a></li>';
        
        document.getElementById('quanti').innerHTML = Object.keys(listaEventos).length;

        document.getElementById('descri').value = '';
        document.getElementById('datepicker').value = '';
        document.getElementById('timepicker1').value = '';
        document.getElementById('timepicker2').value = '';
        document.getElementById('priori').checked = false;
      }

      function removeEvento(e){
        $('[id="'+ e + '"]').remove();
        delete listaEventos[e];
        document.getElementById('quanti').innerHTML = Object.keys(listaEventos).length;
      }

      function limpar(){
        if(Object.entries(listaEventos).length == 0) {
          alert("Adicione algums eventos na lista!!"); 
          return false;
        }
        
        for(var key in listaEventos){
          $('[id="'+ listaEventos[key].der + '"]').remove();
          delete listaEventos[key];
          document.getElementById('quanti').innerHTML = Object.keys(listaEventos).length;
        }
      }

      function organizar(){
        if(Object.entries(listaEventos).length == 0) {
          alert("Adicione algums eventos na lista!!"); 
          return false;
        }

        var resLista = [];
        var newLista = Object.entries(listaEventos).map(([key,value]) => (value));
        newLista = newLista.sort((a,b) => (a.dathof > b.dathof) ? 1 : -1);

        resLista.push(newLista[0])
        for(var i=1; i<newLista.length; ++i){
          if(resLista[i-1].dat == newLista[i].dat){
            if(newLista[i].pri == true){
              if(resLista[i-1].hof > newLista[i].hoi){
                resLista[i-1] = newLista[i];
              }
              else{
                resLista.push(newLista[i]);
              }
            }
            else{
              if(resLista[i-1].hof < newLista[i].hoi){
                resLista.push(newLista[i]);
              }
            }
          }
          else{
            resLista.push(newLista[i]);
          }
        }

        listaRes.innerHTML += '<div class="py-5 text-center" id="rtd"><h2>Resultado</h2><hr></hr></div><div class="card-deck text-center">';
        
        for(var ev of resLista){
          if(ev.pri == true){
            listaRes.innerHTML += '<div class="card border-dark text-white bg-success mb-3" style="max-width: 18rem;"><div class="card-body"><h4 class="card-title">'+ev.dados.desr+'</h4><p class="card-text">Data: '+ev.dados.data+'</p><p class="card-text">Horario: '+ev.dados.hori+' a '+ev.dados.horf+'</p></div></div>';
          }
          else{
            listaRes.innerHTML += '<div class="card border-dark text-white bg-info mb-3" style="max-width: 18rem;"><div class="card-body"><h4 class="card-title">'+ev.dados.desr+'</h4><p class="card-text">Data: '+ev.dados.data+'</p><p class="card-text">Horario: '+ev.dados.hori+' a '+ev.dados.horf+'</p></div></div>';
          }
        }

        listaRes += '</div>';
        
      }

    </script>
  </body>
</html>
<!--
            <div class="py-5 text-center" id="rtd"><h2>Resultado</h2><hr></hr></div><div class="row"><div class="card-deck text-center">

                    <div class="card border-dark text-white bg-success mb-3" style="max-width: 18rem;"><div class="card-body"><h4 class="card-title">Festa de Aniversario do João</h4><p class="card-text">Data: 24/03/2019</p><p class="card-text">Horario: 12:45 AM a 3:45 PM</p></div></div>

                </div></div>